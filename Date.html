<!DOCTYPE html><html lang="en"><head>    <meta charset="utf-8">    <meta http-equiv="X-UA-Compatible" content="IE=edge">    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">    <meta name="description" content="Use Viewer to start building new applications or easily embed Cesium into existing applications.">    <meta name="cesium-sandcastle-labels" content="Beginner, Showcases">    <title>Cesium Demo</title>    <script type="text/javascript" src="../Sandcastle-header.js"></script>    <script type="text/javascript" src="../../../ThirdParty/requirejs-2.1.20/require.js"></script>    <script type="text/javascript">        if(typeof require === "function") {            require.config({                baseUrl : '../../../Source',                waitSeconds : 120            });        }    </script></head><body class="sandcastle-loading" data-sandcastle-bucket="bucket-requirejs.html"><style>    @import url(../templates/bucket.css);    #toolbar {        background: rgba(42, 42, 42, 0.8);        padding: 4px;        border-radius: 4px;    }    #toolbar input {        vertical-align: middle;        padding-top: 2px;        padding-bottom: 2px;    }</style><div id="cesiumContainer" class="fullSize"></div><div id="loadingOverlay"><h1>Loading...</h1></div><div id="toolbar">    <table>    <form>    <div class="nativeDatePicker">      <span class="validity"></span>    </div>    <p class="fallbackLabel">Jump to Date:</p>    <div class="fallbackDatePicker">      <span>        <label for="day">Day:</label>        <select id="day" name="day">        </select>      </span>      <span>        <label for="month">Month:</label>        <select id="month" name="month">          <option selected>January</option>          <option>February</option>          <option>March</option>          <option>April</option>          <option>May</option>          <option>June</option>          <option>July</option>          <option>August</option>          <option>September</option>          <option>October</option>          <option>November</option>          <option>December</option>        </select>      </span>      <span>        <label for="year">Year:</label>        <select id="year" name="year">          <option>2017</option>        </select>      </span>        <span>          <button id="updateDate" type= "button" >Update</button>         </span>          </div></form>    <script id="cesium_sandcastle_script">function startup(Cesium) {    'use strict';//Sandcastle_Beginvar viewer = new Cesium.Viewer('cesiumContainer');var tomorrow = viewer.clock.currentTime; Cesium.JulianDate.addDays(viewer.clock.currentTime, 1, tomorrow);tomorrow = String(tomorrow);var yesterday = viewer.clock.currentTime; Cesium.JulianDate.addDays(viewer.clock.currentTime, -1, yesterday);yesterday = String(yesterday);// The viewModel tracks the state of our mini application.// define variablesvar nativePicker = document.querySelector('.nativeDatePicker');var fallbackPicker = document.querySelector('.fallbackDatePicker');var fallbackLabel = document.querySelector('.fallbackLabel');var yearSelect = document.querySelector('#year');var monthSelect = document.querySelector('#month');var daySelect = document.querySelector('#day');var update = document.querySelector('#updateDate');// hide fallback initiallyfallbackPicker.style.display = 'none';fallbackLabel.style.display = 'none';// test whether a new date input falls back to a text input or notvar test = document.createElement('input');test.type = 'date';// if it does, run the code inside the if() {} blockif(test.type === 'text') {  // hide the native picker and show the fallback  nativePicker.style.display = 'none';  fallbackPicker.style.display = 'block';  fallbackLabel.style.display = 'block';  // populate the days and years dynamically  // (the months are always the same, therefore hardcoded)  populateDays(monthSelect.value);}function populateDays(month) {  // delete the current set of <option> elements out of the  // day <select>, ready for the next set to be injected  while(daySelect.firstChild){    daySelect.removeChild(daySelect.firstChild);  }  // Create variable to hold new number of days to inject  var dayNum;  // 31 or 30 days?  if(month === 'January' || month === 'March' || month === 'May' || month === 'July' || month === 'August' || month === 'October' || month === 'December') {    dayNum = 31;  } else if(month === 'April' || month === 'June' || month === 'September' || month === 'November') {    dayNum = 30;  } else {  // If month is February, calculate whether it is a leap year or not    var year = yearSelect.value;    dayNum = 28;  }  // inject the right number of new <option> elements into the day <select>  for(var i = 1; i <= dayNum; i++) {    var option = document.createElement('option');    option.textContent = i;    daySelect.appendChild(option);  }  // if previous day has already been set, set daySelect's value  // to that day, to avoid the day jumping back to 1 when you  // change the year  if(previousDay) {    daySelect.value = previousDay;    // If the previous day was set to a high number, say 31, and then    // you chose a month with less total days in it (e.g. February),    // this part of the code ensures that the highest day available    // is selected, rather than showing a blank daySelect    if(daySelect.value === "") {      daySelect.value = previousDay - 1;    }    if(daySelect.value === "") {      daySelect.value = previousDay - 2;    }    if(daySelect.value === "") {      daySelect.value = previousDay - 3;    }  }}// when the month or year <select> values are changed, rerun populateDays()// in case the change affected the number of available daysmonthSelect.onchange = function() {  populateDays(monthSelect.value);};//preserve day selectionvar previousDay;// update what day has been set to previously// see end of populateDays() for usagedaySelect.onchange = function() {  previousDay = daySelect.value;};    update.onclick = function() {  viewer.dataSources.removeAll();    var dat = new Date('1 ' + monthSelect.value + ' 1999');    var mon = dat.getMonth();    var newDay = new Date(Date.UTC(yearSelect.value, mon, daySelect.value, 0, 0, 0)).toISOString();  var day = String(newDay.substr(0,10));  viewer.clock.multiplier = 1;  var file = "../../SampleData/czml/" + day +".czml";  viewer.clock.currentTime = Cesium.JulianDate.fromIso8601(day);  //viewer.Timeline.zoomTo(viewer.clock.currentTime,viewer.clock.currentTime);  var timelineLastDay = Cesium.JulianDate.fromIso8601(day);  var timelineFirstDay = Cesium.JulianDate.fromIso8601(day);  Cesium.JulianDate.addDays(Cesium.JulianDate.fromIso8601(day), 4, timelineLastDay);  Cesium.JulianDate.addDays(Cesium.JulianDate.fromIso8601(day), -4, timelineFirstDay);  viewer.timeline.zoomTo(timelineFirstDay,timelineLastDay);  var ICONdata = new Cesium.CzmlDataSource();  var newData = new Cesium.CzmlDataSource();  ICONdata.load(file).then(function(){    viewer.dataSources.add(ICONdata);    viewer.clock.multiplier = 1;  });  var today = new Date(String(viewer.clock.currentTime).substr(0,10) + 'T00:00:00');   for (var i = 0; i<2; i++) {    if (i === 0) {        var tomorrow = viewer.clock.currentTime;         Cesium.JulianDate.addDays(viewer.clock.currentTime, 1, tomorrow);        tomorrow = String(tomorrow);    } if (i === 1) {        var yesterday = viewer.clock.currentTime;         Cesium.JulianDate.addDays(viewer.clock.currentTime, -1, yesterday);        yesterday = String(yesterday);    }    var loadNext = today.toISOString().substr(0,10);    var nextDay = "../../SampleData/czml/" + loadNext +".czml";    viewer.dataSources.add(new Cesium.CzmlDataSource().load(nextDay));    viewer.clock.stopTime = Cesium.JulianDate.fromIso8601(loadNext);  }};var lastLoaded = String(viewer.clock.currentTime).substr(0,10);var myListener = function (clock){  var today = new Date(String(viewer.clock.currentTime).substr(0,10) + 'T00:00:00');  if (lastLoaded != String(viewer.clock.currentTime).substr(0,10)){      today.setDate(today.getDate() - 1);      var loadNext = today.toISOString().substr(0,10);      var nextDay = "../../SampleData/czml/" + loadNext +".czml";	  lastLoaded = String(viewer.clock.currentTime).substr(0,10);	  viewer.dataSources.removeAll();      viewer.dataSources.add(new Cesium.CzmlDataSource().load(nextDay));	  alert("inside loop");      today.setDate(today.getDate() + 1);      var loadNext = today.toISOString().substr(0,10);	  lastLoaded = String(viewer.clock.currentTime).substr(0,10);      var nextDay = "../../SampleData/czml/" + loadNext +".czml";      viewer.dataSources.add(new Cesium.CzmlDataSource().load(nextDay));    }      };viewer.clock.onTick.addEventListener(myListener, function(clock) {  var lastLoaded = String(viewer.clock.currentTime).substr(0,10);});//Sandcastle_End    Sandcastle.finishedLoading();}if (typeof Cesium !== "undefined") {    startup(Cesium);} else if (typeof require === "function") {    require(["Cesium"], startup);}</script></body></html>